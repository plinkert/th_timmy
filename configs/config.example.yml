# Threat Hunting Lab - Example Configuration
# Copy this file to config.yml and fill in values
# WARNING: DO NOT COMMIT config.yml file with real IP addresses and passwords!

# VM Configuration
vms:
  vm01:
    name: "threat-hunt-vm01"
    ip: "10.0.0.10"  # REPLACE with real IP address
    role: "ingest-parser"
    enabled: true
    ssh_user: "thadmin"  # Optional: SSH user for remote access
    ssh_port: 22  # Optional: SSH port (default 22)
  
  vm02:
    name: "threat-hunt-vm02"
    ip: "10.0.0.11"  # REPLACE with real IP address
    role: "database"
    enabled: true
    ssh_user: "thadmin"  # Optional: SSH user for remote access
    ssh_port: 22  # Optional: SSH port (default 22)
  
  vm03:
    name: "threat-hunt-vm03"
    ip: "10.0.0.12"  # REPLACE with real IP address
    role: "analysis-jupyter"
    enabled: true
    ssh_user: "thadmin"  # Optional: SSH user for remote access
    ssh_port: 22  # Optional: SSH port (default 22)
  
  vm04:
    name: "threat-hunt-vm04"
    ip: "10.0.0.13"  # REPLACE with real IP address
    role: "orchestrator-n8n"
    enabled: true
    ssh_user: "thadmin"  # Optional: SSH user for remote access
    ssh_port: 22  # Optional: SSH port (default 22)

# Network Configuration
network:
  subnet: "10.0.0.0/24"  # REPLACE with real subnet
  gateway: "10.0.0.1"     # REPLACE with real gateway
  dns_servers:  # Optional: Custom DNS servers
    - "8.8.8.8"
    - "8.8.4.4"

# Service Ports
services:
  postgresql:
    port: 5432
    host: "vm02"  # Reference to VM-02
  jupyterlab:
    port: 8888
    host: "vm03"  # Reference to VM-03
  n8n:
    port: 5678
    host: "vm04"  # Reference to VM-04

# Database Configuration
database:
  host: "vm02"  # Or use IP address from vms.vm02.ip
  port: 5432
  name: "threat_hunting"
  user: "threat_hunter"
  # password: Set in .env file or use environment variable
  # Connection pool settings
  pool_size: 10
  max_overflow: 20
  pool_timeout: 30

# Logging Configuration
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  file: "logs/threat-hunting-lab.log"
  max_size: "10MB"
  backup_count: 5
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Results Configuration
results:
  output_dir: "results"
  format: "json"  # json, csv, xlsx
  retention_days: 90  # Data retention: 90 days (production-ready)

# Security Configuration
security:
  anonymize_pii: true
  hash_sensitive_fields: true
  encryption_enabled: true
  # SSL/TLS settings (optional)
  ssl_enabled: false
  ssl_cert_path: ""  # Path to SSL certificate
  ssl_key_path: ""   # Path to SSL private key

# Backup Configuration
backup:
  enabled: true
  schedule: "0 2 * * *"  # Daily at 2:00 AM (cron format)
  retention_days: 30  # Keep backups for 30 days
  backup_dir: "/var/backups/threat-hunting"

# Remote Execution Service (Step 0.1 – VM04 orchestration)
remote_execution:
  default_timeout: 30
  default_retry: 3
  max_parallel_commands: 5
  connection_pool_size: 10
  key_storage_type: "encrypted_dir"   # or "vault" when integrated
  key_storage_path: "~/.ssh/th_timmy_keys"
  key_rotation_days: 90
  audit_log_destination: "file"      # or "database"
  checksum_algorithm: "sha256"
  # allowed_vm_ids: ["vm01", "vm02", "vm03", "vm04"]  # optional; default from vms.enabled

# Repository Sync Service (Step 0.2 – sync on VM04, rsync push to VM01–VM03)
repository:
  main_repo_path: "/path/to/th_timmy"   # Path to repo on VM04 (source of truth)
  default_branch: "main"
  # Target paths per vm_id (where rsync writes; VM04 is source only)
  vm_repo_paths:
    vm01: "/home/thadmin/th_timmy"
    vm02: "/home/thadmin/th_timmy"
    vm03: "/home/thadmin/th_timmy"
    vm04: "/path/to/th_timmy"           # Same as main_repo_path on VM04; no push to self
  exclude_dot_git: true                 # Don't push .git to targets (tree-only)
  rsync_excludes:                       # Same style as deploy_to_hosts.sh
    - ".git"
    - "__pycache__"
    - "*.pyc"
    - ".DS_Store"
    - ".vscode"
    - "*.swp"
    - "*.swo"
  auto_sync: false                      # Set true when cron/scheduler runs sync
  secret_scanning:
    enabled: true
    tool: "gitleaks"
    config_path: ".gitleaks.toml"       # Relative to main_repo_path
    block_on_secrets: true
  branch_protection:
    main:
      require_pr: true
      require_reviews: 2
      require_tests: true
      block_direct_push: true           # Configure in GitHub/GitLab; documented here

# Configuration Management Service (Step 0.3 – central config sync, backup, rollback)
config_management:
  backup_location: "/var/backups/th_timmy/config"   # On VM04; create if missing. Use path under home to avoid sudo.
  backup_retention_days: 90
  encryption_method: "AES"
  encryption_key_path: ""                            # Or set TH_TIMMY_CONFIG_BACKUP_KEY_PATH / TH_TIMMY_CONFIG_BACKUP_PASSPHRASE
  backup_remote_path: ""                             # Optional: SCP/SFTP path for off-host copy; empty = local only
  config_paths:                                      # (config_type, vm_id) -> remote path on VM
    central:
      default: "/opt/th_timmy/configs/central.yml"
    vm_specific:
      vm01: "/opt/th_timmy/configs/vm01.yml"
      vm02: "/opt/th_timmy/configs/vm02.yml"
      vm03: "/opt/th_timmy/configs/vm03.yml"
      vm04: "/opt/th_timmy/configs/vm04.yml"
      default: "/opt/th_timmy/configs/vm_specific.yml"
    env:
      default: "/opt/th_timmy/.env"
  config_schemas:                                    # config_type -> schema file (relative to schema_dir)
    central: "central_config.schema.json"
    vm_specific: "vm_config.schema.json"
    env: "env.schema.json"
  schema_dir: "configs/schemas"

# Hardening Configuration (applies to all VMs)
hardening:
  # SSH Configuration (common for all VMs)
  ssh:
    port: 22                    # SSH port (default: 22)
    timeout: 300                # SSH connection timeout in seconds
    disable_root_login: true     # Disable root login via SSH
  
  # Firewall Configuration (common for all VMs)
  firewall:
    allowed_network: ""          # Network CIDR to allow (e.g., "192.168.244.0/24")
                                 # If empty, ports are open to all (less secure)
                                 # Recommended: restrict to your subnet
  
  # VM-01 specific hardening settings
  vm01:
    collector_ports: ""          # Comma-separated collector ports (e.g., "8080,9090")
                                 # These ports will be opened in firewall
    enable_auditd: false        # Enable system auditing with auditd (optional)
  
  # VM-02 specific hardening settings
  vm02:
    enable_auditd: false         # Enable system auditing with auditd (optional)
                                 # Note: PostgreSQL access is controlled via pg_hba.conf
                                 # in hosts/vm02-database/config.yml
  
  # VM-03 specific hardening settings
  vm03:
    enable_auditd: false         # Enable system auditing with auditd (optional)
  
  # VM-04 specific hardening settings
  vm04:
    enable_auditd: false         # Enable system auditing with auditd (optional)

